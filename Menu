local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

local ragdollKey = Enum.KeyCode.R
local isRagdoll = false
local defaultGravity = 196.2
local gravity = defaultGravity

local function setupGUI()
    local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0, 250, 0, 500)
    Frame.Position = UDim2.new(0.05, 0, 0.1, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    Frame.BorderSizePixel = 0

    local dragging, dragStart, startPos

    Frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Frame.Position
        end
    end)

    Frame.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)

    Frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    local function createButton(text, position, callback)
        local button = Instance.new("TextButton", Frame)
        button.Size = UDim2.new(0, 200, 0, 50)
        button.Position = position
        button.Text = text
        button.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.MouseButton1Click:Connect(callback)
        return button
    end

    local function toggleRagdoll()
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoid = character:FindFirstChildOfClass("Humanoid")

        if humanoid then
            if isRagdoll then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
                isRagdoll = false
            else
                humanoid:ChangeState(Enum.HumanoidStateType.Physics)
                isRagdoll = true
            end
        end
    end

    createButton("Toggle Ragdoll (R)", UDim2.new(0, 25, 0, 50), toggleRagdoll)

    local function toggleGravity()
        if gravity == defaultGravity then
            gravity = 1
        else
            gravity = defaultGravity
        end
        Workspace.Gravity = gravity
    end

    createButton("Toggle Gravity", UDim2.new(0, 25, 0, 120), toggleGravity)

    local bindLabel = Instance.new("TextLabel", Frame)
    bindLabel.Text = "Change Ragdoll Key:"
    bindLabel.Size = UDim2.new(0, 200, 0, 30)
    bindLabel.Position = UDim2.new(0, 25, 0, 190)
    bindLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    bindLabel.BackgroundTransparency = 1
    bindLabel.TextScaled = true

    local bindInput = Instance.new("TextBox", Frame)
    bindInput.Size = UDim2.new(0, 200, 0, 30)
    bindInput.Position = UDim2.new(0, 25, 0, 230)
    bindInput.PlaceholderText = "Enter Key (e.g., E)"
    bindInput.Text = ""
    bindInput.TextScaled = true

    bindInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            local newKey = bindInput.Text:upper()
            local success, keyCode = pcall(function()
                return Enum.KeyCode[newKey]
            end)

            if success and keyCode then
                ragdollKey = keyCode
            else
                bindInput.Text = ""
                bindInput.PlaceholderText = "Invalid Key"
            end
        end
    end)

    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == ragdollKey then
            toggleRagdoll()
        end
    end)

    local function addTeleportTool()
        local tool = Instance.new("Tool", player.Backpack)
        tool.Name = "Teleport Tool"
        tool.RequiresHandle = false
        tool.Activated:Connect(function()
            local mouse = player:GetMouse()
            local targetPosition = mouse.Hit.p
            local character = player.Character or player.CharacterAdded:Wait()
            if character then
                character:MoveTo(targetPosition)
            end
        end)
    end

    createButton("Add Teleport Tool", UDim2.new(0, 25, 0, 300), addTeleportTool)
end

player.CharacterAdded:Connect(setupGUI)
setupGUI()
